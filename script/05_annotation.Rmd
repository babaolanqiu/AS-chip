---
title: "Peak Annotation"
author: "Howard Guo"
output: 
html_document:
toc: true
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# 还是在代码里把图做出来，再把图放到这里
# plot peak coverage 
```{r, fig.width=20, fig.height=15,cached=TRUE}
myCluster <- makeCluster(50)
registerDoParallel(myCluster)
foreach(i = seq(1, length(gr_list), by = 4), .inorder = TRUE, .packages = c("ChIPseeker","tidyverse")) %dopar% {
    covplot(gr_list[i:(i + 3)], ylab = "Coverage", xlab = "Genomic Position") + facet_grid(chr ~ .id)
}
stopImplicitCluster()
```
# peak heatmap
```{r,eval=FALSE}
for (i in seq(1, length(gr_list), by = 4)) {
    peakHeatmap(gr_list[i:(i + 3)], color = rainbow(n = 4), TxDb = txdb, upstream = 3000, downstream = 3000) +
        facet_grid(chr ~ .id)
}
```
```{r,echo=FALSE}
knitr::include_graphics("../data/06_annotation/*heatmap.pdf")
```
## plot the profile of peaks that align to flank sequences of TSS
```{r}
myCluster <- makeCluster(50)
registerDoParallel(myCluster)
foreach(i = seq(1, length(gr_list), by = 4), .inorder = TRUE, .packages =c("ChIPseeker","tidyverse")) %dopar% {
    plotAvgProf2(gr_list[i:(i + 3)],
        TxDb = txdb, upstream = 3000, downstream = 3000, ylab = "Read count frequency", xlab = "Genomic Region (5'->3')",
        conf = 0.95, resample = 1000
    ) + facet_grid(chr ~ .id)
}
stopImplicitCluster()
```
## genomic annotation
```{r}
myCluster <- makeCluster(50)
registerDoParallel(myCluster)
foreach(i = seq(1, length(anno_list), by = 1), .inorder = TRUE, .packages = "ChIPseeker") %dopar% {
    plotAnnoPie(anno_list[[i]])
}
foreach(i = seq(1, length(anno_list), by = 1), .inorder = TRUE, .packages = "ChIPseeker") %dopar% {
    plotAnnoBar(anno_list[i])
}
foreach(i = seq(1, length(anno_list), by = 1), .inorder = TRUE, .packages = "ChIPseeker") %dopar% {
    upsetplot(anno_list[[i]], vennpie = TRUE)
}
stopImplicitCluster()
```